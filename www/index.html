<!DOCTYPE html>
<!--
Copyright 2014 Robert Schroll

This file is part of Crosswords and is distributed under the terms
of the GPL. See the file LICENSE for full details.
-->
<html>
  <head>
    <meta charset="utf-8">
    <title>An Ubuntu HTML5 application</title>
    <meta name="description" content="An Ubuntu HTML5 application">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">

    <!-- Ubuntu UI Style imports - Ambiance theme -->
    <link href="css/template.css" rel="stylesheet" type="text/css" />

    <link href="css/app.css" rel="stylesheet" type="text/css" />
    <link href="css/list.css" rel="stylesheet" type="text/css" />
    <link href="css/puzzle.css" rel="stylesheet" type="text/css" />

    <script src="js/jszip.js"></script>
    <script src="js/hammer.js"></script>
    <script src="js/riot.js"></script>
    <!-- Application script -->
    <script src="js/loaders.js"></script>
    <script src="js/database.js"></script>
  </head>

  <body>
    <input type="password" id="focuser" />
    
    <list-page></list-page>
    <puzzle-page></puzzle-page>
    <overlay-dialog id="load-error-dialog" title="Error Loading Puzzle" buttonlabel="Bummer">
      <p>Crosswords received an error, <span id="error-message">{ error }</span>,
      while trying to open the puzzle at <span id="error-url">{ url }</span>.</p>
    </overlay-dialog>
    <overlay-dialog id="info-dialog" buttonlabel="OK">
      <p id="info-creator">{ creator }</p>
      <p id="info-description">{ description }</p>
      <p id="info-copyright">{ copyright }</p>
    </overlay-dialog>
    
    <script src="tags.js"></script>
    <script>
        var displayMixin = {
          init: function () {
            this.displayed = false;
            this.on("update", function () {
              this.root.style.display = this.displayed ? "block" : "none";
            });
          }
        };
        riot.mixin('display', displayMixin);
      
        var list = riot.mount("list-page")[0];
        var puzzle = riot.mount("puzzle-page")[0];
        var dialogs = riot.mount("overlay-dialog");
        
        riot.route.parser(function (path) {
          path = decodeURI(path);
          var command = path.split("/", 1)[0];
          var args = path.slice(command.length + 1);
          return [command, args];
        });
        
        riot.route(function (command, args) {
          if (command == "list") {
            list.update({ displayed: true });
            puzzle.update({ displayed: false, puzzle: null });  // Puzzle set to null to work around riot bug #848
          } else if (command == "load") {
            puzzle.loadURL(args);
          } else if (command == "loaded") {
            list.update({ displayed: false });
            puzzle.update({ displayed: true });
          } else if (command == "error") {
            var arglist = args.split("~~~");
            dialogs[0].update({ displayed: true, error: arglist[0], url: arglist[1] });
          } else if (command == "info") {
            var arglist = args.split("~~~");
            dialogs[1].update({ displayed: true, title: arglist[0], creator: arglist[1],
                                description: arglist[2], copyright: arglist[3] });
          }
        });
        list.update({ displayed: true });
    </script>

  </body>
</html>
